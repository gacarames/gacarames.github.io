!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).handorgel=factory()}(this,function(){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var module,evEmitter=(function(module){var global,factory;global="undefined"!=typeof window?window:commonjsGlobal,factory=function(){function EvEmitter(){}var proto=EvEmitter.prototype;return proto.on=function(eventName,listener){if(eventName&&listener){var events=this._events=this._events||{},listeners=events[eventName]=events[eventName]||[];return-1==listeners.indexOf(listener)&&listeners.push(listener),this}},proto.once=function(eventName,listener){if(eventName&&listener){this.on(eventName,listener);var onceEvents=this._onceEvents=this._onceEvents||{};return(onceEvents[eventName]=onceEvents[eventName]||{})[listener]=!0,this}},proto.off=function(eventName,listener){var listeners=this._events&&this._events[eventName];if(listeners&&listeners.length){var index=listeners.indexOf(listener);return-1!=index&&listeners.splice(index,1),this}},proto.emitEvent=function(eventName,args){var listeners=this._events&&this._events[eventName];if(listeners&&listeners.length){listeners=listeners.slice(0),args=args||[];for(var onceListeners=this._onceEvents&&this._onceEvents[eventName],i=0;i<listeners.length;i++){var listener=listeners[i];onceListeners&&onceListeners[listener]&&(this.off(eventName,listener),delete onceListeners[listener]),listener.apply(this,args)}return this}},proto.allOff=function(){delete this._events,delete this._onceEvents},EvEmitter},module.exports?module.exports=factory():global.EvEmitter=factory()}(module={exports:{}},module.exports),module.exports),rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;function isWritable(obj,key){var descriptor=Object.getOwnPropertyDescriptor(obj,key);return void 0===obj[key]||descriptor&&descriptor.writable}function extend(src){for(var obj,args=arguments,i=1;i<args.length;++i)if(obj=args[i])for(var key in obj)isWritable(src,key)&&(src[key]=obj[key]);return src}var ID_COUNTER={},ARIA_ATTRIBUTES={button:{"aria-controls":function(){return this.id+"-content"},"aria-expanded":function(){return this.expanded?"true":"false"},"aria-disabled":function(){return this.disabled?"true":"false"}},content:{role:function(){return"region"},"aria-labelledby":function(){return this.id+"-header"}}},KEYS_arrowDown=40,KEYS_arrowUp=38,KEYS_pageUp=33,KEYS_pageDown=34,KEYS_end=35,KEYS_home=36,HandorgelFold=function(){function HandorgelFold(handorgel,header,content){_classCallCheck(this,HandorgelFold),header.handorgelFold||(this.handorgel=handorgel,this.header=header,this.button=header.firstElementChild,this.content=content,this.header.handorgelFold=this,this.content.handorgelFold=this,ID_COUNTER[this.handorgel.id]||(ID_COUNTER[this.handorgel.id]=0),this.id="".concat(this.handorgel.id,"-fold").concat(++ID_COUNTER[this.handorgel.id]),this.header.setAttribute("id",this.id+"-header"),this.content.setAttribute("id",this.id+"-content"),this.focused=!1,this.expanded=!1,this.disabled=!1,this._listeners={},this._bindEvents(),this._initAria(),this._initialOpen(),this._initialFocus())}return _createClass(HandorgelFold,[{key:"open",value:function(){var transition=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.expanded)if(this.handorgel.emitEvent("fold:open",[this]),this.expanded=!0,this.handorgel.options.collapsible||this.disable(),this._updateAria("button","aria-expanded"),this.header.classList.add(this.handorgel.options.headerOpenClass),this.content.classList.add(this.handorgel.options.contentOpenClass),transition){var height=this.content.firstElementChild.offsetHeight;this.content.style.height="".concat(height,"px")}else this._opened()}},{key:"close",value:function(){var _this=this,transition=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.expanded)if(this.handorgel.emitEvent("fold:close",[this]),this.expanded=!1,this.handorgel.options.collapsible||this.enable(),this._updateAria("button","aria-expanded"),this.header.classList.remove(this.handorgel.options.headerOpenedClass),this.content.classList.remove(this.handorgel.options.contentOpenedClass),transition){var height=this.content.firstElementChild.offsetHeight;this.content.style.height="".concat(height,"px"),rAF(function(){_this.content.style.height="0px"})}else this._closed()}},{key:"disable",value:function(){this.disabled=!0,this._updateAria("button","aria-disabled"),this.header.classList.add(this.handorgel.options.headerDisabledClass),this.content.classList.add(this.handorgel.options.contentDisabledClass)}},{key:"enable",value:function(){this.disabled=!1,this._updateAria("button","aria-disabled"),this.header.classList.remove(this.handorgel.options.headerDisabledClass),this.content.classList.remove(this.handorgel.options.contentDisabledClass)}},{key:"focus",value:function(){this.button.focus()}},{key:"blur",value:function(){this.button.blur()}},{key:"toggle",value:function(){var transition=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.expanded?this.close(transition):this.open(transition)}},{key:"destroy",value:function(){this._unbindEvents(),this._cleanAria(),this.header.classList.remove(this.handorgel.options.headerOpenClass),this.header.classList.remove(this.handorgel.options.headerOpenedClass),this.header.classList.remove(this.handorgel.options.headerFocusClass),this.content.classList.remove(this.handorgel.options.contentOpenClass),this.content.classList.remove(this.handorgel.options.contentOpenedClass),this.content.classList.remove(this.handorgel.options.contentFocusClass),this.content.style.height="0px",this.header.handorgelFold=null,this.content.handorgelFold=null,this.header.removeAttribute("id"),this.content.removeAttribute("id"),this.handorgel=null}},{key:"_opened",value:function(){this.content.style.height="auto",this.header.classList.add(this.handorgel.options.headerOpenedClass),this.content.classList.add(this.handorgel.options.contentOpenedClass),this.handorgel.emitEvent("fold:opened",[this])}},{key:"_closed",value:function(){this.header.classList.remove(this.handorgel.options.headerOpenClass),this.content.classList.remove(this.handorgel.options.contentOpenClass),this.handorgel.emitEvent("fold:closed",[this])}},{key:"_initialOpen",value:function(){var _this2=this;null===this.header.getAttribute(this.handorgel.options.initialOpenAttribute)&&null===this.content.getAttribute(this.handorgel.options.initialOpenAttribute)||(this.handorgel.options.initialOpenTransition?window.setTimeout(function(){_this2.open()},this.handorgel.options.initialOpenTransitionDelay):this.open(!1))}},{key:"_initialFocus",value:function(){null!==this.button.getAttribute("autofocus")&&this._handleFocus()}},{key:"_initAria",value:function(){this._updateAria("button"),this._updateAria("content")}},{key:"_cleanAria",value:function(){this._updateAria("button",null,!0),this._updateAria("content",null,!0)}},{key:"_updateAria",value:function(element){var property=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,remove=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.handorgel.options.ariaEnabled)if(property){var newValue=ARIA_ATTRIBUTES[element][property].call(this);this[element].setAttribute(property,newValue)}else for(var _property in ARIA_ATTRIBUTES[element])if(ARIA_ATTRIBUTES[element].hasOwnProperty(_property))if(remove)this[element].removeAttribute(_property);else{var _newValue=ARIA_ATTRIBUTES[element][_property].call(this);this[element].setAttribute(_property,_newValue)}}},{key:"_handleContentTransitionEnd",value:function(e){e.target===e.currentTarget&&"height"===e.propertyName&&(this.expanded?this._opened():this._closed())}},{key:"_handleFocus",value:function(){this.focused=!0,this.header.classList.add(this.handorgel.options.headerFocusClass),this.content.classList.add(this.handorgel.options.contentFocusClass),this.handorgel.emitEvent("fold:focus",[this])}},{key:"_handleBlur",value:function(){this.focused=!1,this.header.classList.remove(this.handorgel.options.headerFocusClass),this.content.classList.remove(this.handorgel.options.contentFocusClass),this.handorgel.emitEvent("fold:blur",[this])}},{key:"_handleButtonClick",value:function(e){this.focus(),this.disabled||this.toggle()}},{key:"_handleButtonKeydown",value:function(e){if(this.handorgel.options.keyboardInteraction){var action=null;switch(e.which){case KEYS_arrowDown:action="next";break;case KEYS_arrowUp:action="prev";break;case KEYS_home:action="first";break;case KEYS_end:action="last";break;case KEYS_pageDown:e.ctrlKey&&(action="next");break;case KEYS_pageUp:e.ctrlKey&&(action="prev")}action&&(e.preventDefault(),this.handorgel.focus(action))}}},{key:"_handleContentKeydown",value:function(e){if(this.handorgel.options.keyboardInteraction&&e.ctrlKey){var action=null;switch(e.which){case KEYS_pageDown:action="next";break;case KEYS_pageUp:action="prev"}action&&(e.preventDefault(),this.handorgel.focus(action))}}},{key:"_bindEvents",value:function(){for(var key in this._listeners={bFocus:["focus",this.button,this._handleFocus.bind(this)],bBlur:["blur",this.button,this._handleBlur.bind(this)],bClick:["click",this.button,this._handleButtonClick.bind(this)],bKeydown:["keydown",this.button,this._handleButtonKeydown.bind(this)],cKeydown:["keydown",this.content,this._handleContentKeydown.bind(this)],cTransition:["transitionend",this.content,this._handleContentTransitionEnd.bind(this)]},this._listeners)if(this._listeners.hasOwnProperty(key)){var listener=this._listeners[key];listener[1].addEventListener(listener[0],listener[2])}}},{key:"_unbindEvents",value:function(){for(var key in this._listeners)if(this._listeners.hasOwnProperty(key)){var listener=this._listeners[key];listener[1].removeEventListener(listener[0],listener[2])}}}]),HandorgelFold}(),ID_COUNTER$1=0,Handorgel=function(){function Handorgel(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,Handorgel),element.handorgel||(this.element=element,this.element.handorgel=this,this.id="handorgel".concat(++ID_COUNTER$1),this.element.setAttribute("id",this.id),this.folds=[],this.options=extend({},Handorgel.defaultOptions,options),this._listeners={},this._bindEvents(),this._initAria(),this.update())}return _createClass(Handorgel,[{key:"update",value:function(){this.folds=[];for(var children=this.element.children,i=0,childrenLength=children.length;i<childrenLength;i+=2){var header=children[i],content=children[i+1],fold=header.handorgelFold;!fold&&header&&content&&(fold=new HandorgelFold(this,header,content)),fold&&this.folds.push(fold)}}},{key:"focus",value:function(target){for(var foldsLength=this.folds.length,currentFocusedIndex=null,i=0;i<foldsLength&&null===currentFocusedIndex;i++)this.folds[i].focused&&(currentFocusedIndex=i);if("prev"!==target&&"next"!==target||null!==currentFocusedIndex||(target="prev"===target?"last":"first"),"prev"===target&&0===currentFocusedIndex){if(!this.options.carouselFocus)return;target="last"}if("next"===target&&currentFocusedIndex===foldsLength-1){if(!this.options.carouselFocus)return;target="first"}switch(target){case"prev":this.folds[--currentFocusedIndex].focus();break;case"next":this.folds[++currentFocusedIndex].focus();break;case"last":this.folds[foldsLength-1].focus();break;case"first":default:this.folds[0].focus()}}},{key:"destroy",value:function(){this.emitEvent("destroy"),this.element.removeAttribute("id"),this.folds.forEach(function(fold){fold.destroy()}),this._unbindEvents(),this._cleanAria(),this.element.handorgel=null,this.emitEvent("destroyed")}},{key:"_handleFoldOpen",value:function(openFold){this.options.multiSelectable||this.folds.forEach(function(fold){openFold!==fold&&fold.close()})}},{key:"_initAria",value:function(){this.options.ariaEnabled&&this.options.multiSelectable&&this.element.setAttribute("aria-multiselectable","true")}},{key:"_cleanAria",value:function(){this.element.removeAttribute("aria-multiselectable")}},{key:"_bindEvents",value:function(){this._listeners.foldOpen=this._handleFoldOpen.bind(this),this.on("fold:open",this._listeners.foldOpen)}},{key:"_unbindEvents",value:function(){this.off("fold:open",this._listeners.foldOpen)}}]),Handorgel}();return extend(Handorgel.prototype,evEmitter.prototype),Handorgel.defaultOptions={keyboardInteraction:!0,multiSelectable:!0,ariaEnabled:!0,collapsible:!0,carouselFocus:!0,initialOpenAttribute:"data-open",initialOpenTransition:!0,initialOpenTransitionDelay:200,headerOpenClass:"handorgel__header--open",contentOpenClass:"handorgel__content--open",headerOpenedClass:"handorgel__header--opened",contentOpenedClass:"handorgel__content--opened",headerDisabledClass:"handorgel__header--disabled",contentDisabledClass:"handorgel__content--disabled",headerFocusClass:"handorgel__header--focus",contentFocusClass:"handorgel__content--focus"},Handorgel});